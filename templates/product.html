[[extend 'layout.html']]

<style>
[v-cloak] {
     display: none;
}

.margin-center-max-width-1000px {
  margin: auto;
  max-width: 1000px;
}

.img-preview {
  float: right;
  width: 50px;
  height: 50px;
  margin-right: 10px;
}

.img-preview.selected {
  border-style: solid;
  border-width: 4px;
  border-color: transparent;
}

.rate-button {
  width:150px;
  color: white;
  background-color: red;
}

.buy-button {
  width:150px;
  color: white;
  background-color: green;
}

.subtitle-margin {
  margin-top: 45px;
}

.comment-text {
  text-align: left;
}
</style>

<div id="rating-target">
  <span @mouseout="stars_out()">
    <span @mouseover="stars_over(star_idx)"
          @click="set_stars(star_idx)"
          v-for="star_idx in [1, 2, 3, 4, 5]">
      <i v-if="star_idx <= display" class="fa fa-star"></i>
      <i v-if="star_idx > display" class="fa fa-star-o"></i>
    </span>
  </span>
</div>


<div id="vue-target" class="section margin-center-max-width-1000px" v-cloak>
  <div class="columns block is-mobile">
    <div class="column is-half">
      <div class="columns block is-mobile">
        <div class="column is-one-quarter">
          [[for image in product.get("images", ""):]]
          <div :class="'[[=URL('static', image)]]' == productImage ? 'block img-preview selected' : 'block img-preview'" @click="productImage='[[=URL('static', image)]]'">
            <div class="card">
              <div class="card-image">
                <figure class="image is-1by1">
                  <img src="[[=URL('static', image)]]">
                </figure>
              </div>
            </div>
          </div>
          [[pass]]
        
        </div>
        <div class="column is-three-quarters">

          <div id="product_image" class="card">
            <div class="card-image">
              <figure class="image is-1by1">
                <img :src=productImage>
              </figure>
            </div>
          </div>

        </div>
      </div>
  </div>

  <!-- <div class="column is-half">
    <div><b>[[=product.get("name", "n/a")]] <a href="[[=URL('profile', product.get('seller', ''))]]">([[=product.get("seller", "n/a")]])</a></b></div>
    <div><b>Price $[[=product.get("price", "n/a")]], In Stock: [[=product.get('amount', '0')]]</b></div>
    <div>[[=product.get("description", "")]]</div>
  </div> -->
</div>

<section class="section margin-center-max-width-1000px">
  <div class="columns block is-mobile">
    <div class="column is-half">
      <center>

        <button class="button rate-button">Rate</button>
        <br/>
        <h1 class="subtitle subtitle-margin">Comments</h1>

        <div class="field">
          <div class="control is-small">
            <div class="columns block is-mobile">
              <div class="column is-two-thirds">
                <input class="input is-small" v-model="new_comment" @click="can_comment" type="text" placeholder="Add a comment">
              </div>
              <div class="column is-one-third">
                <button class="button is-primary" @click="add_comment" >Add</button>
              </div>
            </div>
          </div>
        </div>

        <div v-for="comment in comments" class="block">
          <div class="columns block is-mobile">
            <div class="column is-one-quarter">
              <div class="card">
                <div class="card-image">
                  <figure class="image is-1by1">
                    <img :src="comment.profile_pic">
                  </figure>
                </div>
              </div>
            </div>
            <div class="column is-two-quarters comment-text">
              <a :href="comment.profile_link">@{{comment.username}}</a> {{comment.text}}
            </div>
          </div>
        </div>

      </center>
    </div>
    <div class="column is-half">
      <center>

        <button class="button buy-button">Buy</button>
        <br/>
        <h1 class="subtitle subtitle-margin">Reviews</h1>

        <div class="field">
          <div class="control is-small">
            <div class="columns block is-mobile">
              <div class="column is-two-thirds">
                <input class="input is-small" v-model="new_review" @click="can_review" type="text" placeholder="Add a review">
              </div>
              <div class="column is-one-third">
                <button class="button is-primary" @click="add_review" >Add</button>
              </div>
            </div>
          </div>
        </div>

        <div v-for="review in reviews" class="block">
          <div class="columns block is-mobile">
            <div class="column is-one-quarter">
              <div class="card">
                <div class="card-image">
                  <figure class="image is-1by1">
                    <img :src="review.profile_pic">
                  </figure>
                </div>
              </div>
            </div>
            <div class="column is-two-quarters comment-text">
              <a :href="review.profile_link">@{{review.username}}</a> {{review.text}}
            </div>
          </div>
        </div>

      </center>
    </div>
  </div>
</section>
</div>
<!-- body END -->


[[block page_scripts]]
<!-- Loads the index-specific js for Vue -->
<script type="text/javascript">
  let initialProductImage = "[[=URL('static', product.get('images',0)[0])]]"
  let my_callback_url = "[[=XML(my_callback_url)]]"
  let set_rating_url = "[[=XML(set_rating_url)]]"
  let get_rating_url = "[[=XML(get_rating_url)]]"
  let get_comments_url = "[[=XML(get_comments_url)]]"
  let get_reviews_url = "[[=XML(get_reviews_url)]]"
  let post_comment_url = "[[=XML(post_comment_url)]]"
  let post_reviews_url = "[[=XML(post_reviews_url)]]"
  let isAuthenticated = [[=isAuthenticated]]
</script>
<script src="js/product.js"></script>
<script src="js/rating.js"></script>
[[end]]
